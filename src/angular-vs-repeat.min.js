//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.0.0-rc12 2015/08/03
//
!function(e,t){"use strict";function n(){if("pageYOffset"in e)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var t,n,s=document,r=s.documentElement,a=s.body;return t=r.scrollLeft||a.scrollLeft||0,n=r.scrollTop||a.scrollTop||0,{scrollTop:n,scrollLeft:t}}function s(t,n){return t===e?"clientWidth"===n?e.innerWidth:e.innerHeight:t[n]}function r(t,s){return t===e?n()[s]:t[s]}function a(t,s,r){var a=t.getBoundingClientRect()[r?"left":"top"],o=s===e?0:s.getBoundingClientRect()[r?"left":"top"],i=a-o+(s===e?n():s)[r?"scrollLeft":"scrollTop"];return i}var o=document.documentElement,i=o.matches?"matches":o.matchesSelector?"matchesSelector":o.webkitMatches?"webkitMatches":o.webkitMatchesSelector?"webkitMatchesSelector":o.msMatches?"msMatches":o.msMatchesSelector?"msMatchesSelector":o.mozMatches?"mozMatches":o.mozMatchesSelector?"mozMatchesSelector":null,l=t.element.prototype.closest||function(e){for(var n=this[0].parentNode;n!==document.documentElement&&null!=n&&!n[i](e);)n=n.parentNode;return n&&n[i](e)?t.element(n):t.element()},c=t.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(n,o){return{restrict:"A",scope:!0,compile:function(i){var c,f,d,p,u,h,m=i.children().eq(0),v=i.children(),x=m[0].outerHTML,$="$vs_collection",g=!1,z={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsExcess:"excess"};if(m.attr("ng-repeat"))h="ng-repeat",c=m.attr("ng-repeat");else if(m.attr("data-ng-repeat"))h="data-ng-repeat",c=m.attr("data-ng-repeat");else if(m.attr("ng-repeat-start"))g=!0,h="ng-repeat-start",c=m.attr("ng-repeat-start");else{if(!m.attr("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");g=!0,h="data-ng-repeat-start",c=m.attr("data-ng-repeat-start")}if(f=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(c),d=f[1],p=f[2],u=f[3],g)for(var S=0,I=i.children().eq(0);null==I.attr("ng-repeat-end")&&null==I.attr("data-ng-repeat-end");)S++,I=i.children().eq(S),x+=I[0].outerHTML;return i.empty(),{pre:function(i,c,f){function m(){if(!A||A.length<1)return i[$]=[],R=0,w(0),void(i.sizesCumulative=[0]);if(R=A.length,H){i.sizes=A.map(function(e){var n=i.$new(!1);t.extend(n,e),n[d]=e;var s=f.vsSize||f.vsSizeProperty?n.$eval(f.vsSize||f.vsSizeProperty):i.elementSize;return n.$destroy(),s});var e=0;i.sizesCumulative=i.sizes.map(function(t){var n=e;return e+=t,n}),i.sizesCumulative.push(e)}else S();M()}function S(){P&&i.$$postDigest(function(){if(c[0].offsetHeight||c[0].offsetWidth){for(var e=c.children(),t=0,n=!1,s=!1;t<e.length;){if(null!=e[t].attributes[h]||s){if(n||(i.elementSize=0),n=!0,e[t][W]&&(i.elementSize+=e[t][W]),!g)break;if(null!=e[t].attributes["ng-repeat-end"]||null!=e[t].attributes["data-ng-repeat-end"])break;s=!0}t++}n&&(M(),P=!1,i.$root&&!i.$root.$$phase&&i.$apply())}else var r=i.$watch(function(){(c[0].offsetHeight||c[0].offsetWidth)&&(r(),S())})})}function I(){"undefined"!=typeof f.vsAutoresize&&(P=!0,S(),i.$root&&!i.$root.$$phase&&i.$apply()),b()&&i.$apply()}function M(){N=void 0,F=void 0,Y=R,j=0,b(),w(H?i.sizesCumulative[R]:i.elementSize*R),i.$emit("vsRepeatReinitialized",i.startIndex,i.endIndex)}function w(e){i.totalSize=i.offsetBefore+e+i.offsetAfter}function y(){var e=s(O[0],E);e!==U&&(M(),i.$root&&!i.$root.$$phase&&i.$apply()),U=e}function b(){var e=r(O[0],D),t=s(O[0],E),n=c[0]===O[0]?0:a(c[0],O[0],T),l=i.startIndex,f=i.endIndex;if(H){for(l=0;i.sizesCumulative[l]<e-i.offsetBefore-n;)l++;for(l>0&&l--,l=Math.max(Math.floor(l-i.excess/2),0),f=l;i.sizesCumulative[f]<e-i.offsetBefore-n+t;)f++;f=Math.min(Math.ceil(f+i.excess/2),R)}else l=Math.max(Math.floor((e-i.offsetBefore-n)/i.elementSize)-i.excess/2,0),f=Math.min(l+Math.ceil(t/i.elementSize)+i.excess,R);Y=Math.min(l,Y),j=Math.max(f,j),i.startIndex=q.latch?Y:l,i.endIndex=q.latch?j:f;var d=!1;if(null==N?d=!0:null==F&&(d=!0),d||(q.hunked?Math.abs(i.startIndex-N)>=i.excess/2||0===i.startIndex&&0!==N?d=!0:(Math.abs(i.endIndex-F)>=i.excess/2||i.endIndex===R&&F!==R)&&(d=!0):d=i.startIndex!==N||i.endIndex!==F),d){i[$]=A.slice(i.startIndex,i.endIndex),i.$emit("vsRepeatInnerCollectionUpdated",i.startIndex,i.endIndex,N,F),N=i.startIndex,F=i.endIndex;var p=H?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",u=o(p),h=u(i,{$index:0}),m=u(i,{$index:i[$].length}),v=i.totalSize,x=T?"width":"height";k.css(x,h+"px"),L.css(x,v-m+"px")}return d}if(!i.$eval(f.vsRepeatIf))return void c.append(n(v)(i));var R,C=t.element(x),B=C[0].tagName.toLowerCase(),A=[],T="undefined"!=typeof f.vsHorizontal,k=t.element("<"+B+' class="vs-repeat-before-content"></'+B+">"),L=t.element("<"+B+' class="vs-repeat-after-content"></'+B+">"),P=!f.vsRepeat,H=!!f.vsSize||!!f.vsSizeProperty,O=f.vsScrollParent?"window"===f.vsScrollParent?t.element(e):l.call(c,f.vsScrollParent):c,q="vsOptions"in f?i.$eval(f.vsOptions):{},E=T?"clientWidth":"clientHeight",W=T?"offsetWidth":"offsetHeight",D=T?"scrollLeft":"scrollTop";if(i.totalSize=0,!("vsSize"in f)&&"vsSizeProperty"in f&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===O.length)throw"Specified scroll parent selector did not match any element";i.$scrollParent=O,H&&(i.sizesCumulative=[]),i.elementSize=+f.vsRepeat||s(O[0],E)||50,i.offsetBefore=0,i.offsetAfter=0,i.excess=2,T?(k.css("height","100%"),L.css("height","100%")):(k.css("width","100%"),L.css("width","100%")),Object.keys(z).forEach(function(e){f[e]&&f.$observe(e,function(t){i[z[e]]=+t,M()})}),i.$watchCollection(p,function(e){A=e||[],m()}),C.eq(0).attr(h,d+" in "+$+(u?" "+u:"")),C.addClass("vs-repeat-repeated-element"),c.append(k),c.append(C),n(C)(i),c.append(L),i.startIndex=0,i.endIndex=0,O.on("scroll",function(){b()&&i.$apply()}),t.element(e).on("resize",I),i.$on("$destroy",function(){t.element(e).off("resize",I)}),i.$on("vsRepeatTrigger",m),i.$on("vsRepeatResize",function(){P=!0,S()});var N,F,Y,j;i.$on("vsRenderAll",function(){q.latch&&setTimeout(function(){var e=R;j=Math.max(e,j),i.endIndex=q.latch?j:e,i[$]=A.slice(i.startIndex,i.endIndex),F=i.endIndex,i.$$postDigest(function(){var e=T?"width":"height";k.css(e,0),L.css(e,0)}),i.$apply(function(){i.$emit("vsRenderAllDone")})})});var U;i.$watch(function(){"function"==typeof e.requestAnimationFrame?e.requestAnimationFrame(y):y()})}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=c.name)}(window,window.angular);